/*!
 * 
 * Copyright 2023 NAVER Corp. All Rights reserved.
 * All rights, including but not limited to, copyrights,
 * and intellectual property rights of this source code are owned by NAVER Corp.
 * 
 * You may not use, reproduce, modify, or distribute this source code
 * without prior written permission from NAVER Corp.
 * 
 */!function(e){var t={};function a(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,a),r.l=!0,r.exports}a.m=e,a.c=t,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)a.d(n,r,function(t){return e[t]}.bind(null,r));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=14)}([function(e,t){e.exports=function(){"use strict";const e={};return whale.runtime.onMessage.addListener((function(t,a,n){t.namespace&&Array.isArray(e[t.namespace])&&e[t.namespace].forEach(e=>{e(t.message,a,n)});return!0})),{broadcast:function(e,t){if(!whale.tabs)return new Promise((e,t)=>{t()});const a=[];return whale.tabs.query({},n=>{n.forEach(n=>{a.push(new Promise(a=>{whale.tabs.sendMessage(n.id,{namespace:e,message:t},e=>{whale.runtime.lastError,a(e)})}))})}),Promise.all(a)},listen:function(t,a){e[t]=e[t]||[],e[t].push(a)},send:function(e,t,a,n){return new Promise(r=>{void 0!==a&&a>-1?whale.tabs.sendMessage(a,{namespace:e,message:t},void 0!==n&&n>-1?{frameId:n}:{},e=>{whale.runtime.lastError,r(e)}):whale.runtime.sendMessage({namespace:e,message:t},e=>{whale.runtime.lastError,r(e)})})}}}()},function(e,t,a){"use strict";var n=a(2);const r=["ko","en","ja","zh-CN"];t.a={detect:({image:e,srcLang:t,tarLang:a,isUrl:r})=>new Promise(async(s,o)=>{const i=r?"https://apis.naver.com/whale/papago/ocr/detectFromUrl":"https://apis.naver.com/whale/papago/ocr/detect",c=new FormData;c.append("image",e),c.append("source",t),c.append("target",a);const u=await Object(n.a)(i),l=new XMLHttpRequest;l.open("POST",u),l.onload=function(){try{const e=JSON.parse(this.response);if(!e.renderedImage&&!e.ocrs)throw!1;s(e)}catch(e){o()}},l.onerror=function(){o()},l.send(c)}),extractTexts:e=>{const t=(e=>{if(!Array.isArray(e)||!e.length)return;const t=[];return e.forEach(e=>{if(void 0!==e.text)if(t.length>=1&&((e,t)=>t.LT.y-10<=e.y&&t.LB.y+10>=e.y)(t[t.length-1],e)){const a=t.pop();t.push({x:a.x,y:a.y,width:e.RB.x-a.x,height:e.RB.y-a.y,text:`${a.text} ${e.text}`})}else t.push({x:e.LT.x,y:e.LT.y,width:e.RB.x-e.LT.x,height:e.RB.y-e.LT.y,text:e.text})}),t})(e);return Array.isArray(t)&&t.length?t.map(({text:e})=>e):null},isSupportedLanguage:e=>r.includes(e),getSupportedLanguages:()=>r}},function(e,t,a){"use strict";function n(e){return new Promise((t,a)=>{whale&&whale.utility&&whale.utility.getHmacURL?whale.utility.getHmacURL(e,e=>{t(e)}):a()})}a.d(t,"a",(function(){return n}))},,function(e,t,a){"use strict";var n=a(2);const r="https://apis.naver.com/whale/papago/nsmt/translate",s="https://apis.naver.com/whale/papago/n2mt/translate",o=["ko","en","ja","zh-CN","es","fr","de","ru","vi","th","id","it","pt","hi"],i=["ko","en","ja","zh-CN","es","fr","de","ru","vi","th","id","it"],c={sources:o},u=()=>{c.targets||(c.targets={},o.forEach(e=>{["pt","hi"].includes(e)?c.targets[e]=["en"]:c.targets[e]="en"===e?o.filter(t=>t!==e):o.filter(t=>!["pt","hi",e].includes(t))})),c.nmt||(c.nmt={},i.forEach(e=>{c.nmt[e]=i.filter(t=>t!==e)}))},l=()=>(u(),c),d=(e,t)=>(u(),t?c.sources.includes(e)&&c.targets[e].includes(t):c.sources.includes(e));t.a={run:async(e,t,a)=>{if(0===(a||"").trim().length)return a;if(e===t)throw!1;if(!d(e,t))throw!1;const o=await(async(e,t)=>{const{nmt:a}=l(),o=a[e]&&a[e].includes(t);return await Object(n.a)(o?s:r)})(e,t),i=await fetch(o,{method:"post",mode:"cors",body:[`source=${e}`,`target=${t}`,`text=${encodeURIComponent(a)}`].join("&"),headers:new Headers({"Content-Type":"application/x-www-form-urlencoded"})});if(!i.ok)throw!1;const c=await i.json();if(!c||!c.message||!c.message.result)throw!1;return c.message.result.translatedText},isSupported:d,getSupportedLanguages:l}},,,,,,,,,,function(e,t,a){a(17),a(18),e.exports=a(15)},function(e,t){var a,n,r,s,o,i;a=window,n=document,r="script",s="ga",a.GoogleAnalyticsObject=s,a.ga=a.ga||function(){(a.ga.q=a.ga.q||[]).push(arguments)},a.ga.l=Number(new Date),o=n.createElement(r),i=n.getElementsByTagName(r)[0],o.async=1,o.src="https://www.google-analytics.com/analytics.js",o.addEventListener("load",()=>{whale.storage.local.get("GA_LOCAL_STORAGE_KEY",({GA_LOCAL_STORAGE_KEY:e})=>{e?ga("create","UA-103600426-13",{storage:"none",clientId:e}):ga("create","UA-103600426-13","auto"),ga(e=>{whale.storage.local.set({GA_LOCAL_STORAGE_KEY:e.get("clientId")})}),ga("set","checkProtocolTask",null)})}),i.parentNode.insertBefore(o,i)},,function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n);const s=e=>new Promise((t,a)=>{if(e.startsWith("data:image/")){const n=new Image;n.onload=()=>{t(n)},n.onerror=()=>{a()},n.src=e}else{const n=new XMLHttpRequest;n.open("GET",e),n.responseType="blob",n.onload=()=>{n.status>=400&&a();const e=new Image;e.onload=()=>{t(e)},e.src=URL.createObjectURL(n.response)},n.onerror=()=>{a()},n.send()}}),o=(e,t)=>new Promise(a=>{const n=document.createElement("canvas");n.width=t.dwidth,n.height=t.dheight,n.getContext("2d").drawImage(e,t.sx,t.sy,t.swidth,t.sheight,t.dx,t.dy,t.dwidth,t.dheight),n.toBlob(e=>{(e=>{navigator.devBuild&&window.debug&&window.open(URL.createObjectURL(e))})(e),a(e)},"image/jpeg",1)}),i=({rawBlob:e,imageUrl:t})=>{let a=e.split(t).pop();return a.startsWith("\r\n\r\n")&&(a=a.substring("\r\n\r\n".length)),a.replace(/[^a-zA-Z0-9+/]/gi,"")},c=async(e,t)=>{const a=await(({tabId:e})=>new Promise(t=>{whale.pageCapture.saveAsMHTML({tabId:e},e=>{t(e)})}))({tabId:e}),n=URL.createObjectURL(a),r=await(await fetch(n)).text();URL.revokeObjectURL(n);const s=await(({texts:e,imageUrl:t})=>new Promise((a,n)=>{const[,r]=e.match(/boundary="(.+)"/),[s]=e.split(r).filter(e=>e.includes(t));s?a(s):n()}))({texts:r,imageUrl:t}),o=(({rawBlob:e})=>{const t=e.indexOf("Content-Type: ")+"Content-Type: ".length,a=e.substring(t).indexOf("\r\n");return e.substring(t,t+a)})({rawBlob:s});return{blob:(({base64Data:e,mimeType:t})=>{const a=atob(e),n=[];for(let e=0;e<a.length;e+=512){const t=a.slice(e,e+512),r=new Array(t.length);for(let e=0;e<t.length;e+=1)r[e]=t.charCodeAt(e);const s=new Uint8Array(r);n.push(s)}return new Blob(n,{type:t})})({base64Data:i({rawBlob:s,imageUrl:t}),mimeType:o}),mimeType:o}};var u={getCropped:async({imageUrl:e,bound:t,scaleX:a=1,scaleY:n=1},r)=>{const i=await(async(e,t)=>{let a;try{a=await s(e)}catch(n){if(void 0===t)return;const{blob:r,mimeType:o}=await c(t,e),i=URL.createObjectURL(r,o);a=await s(i)}return a})(e,r);if(!i)return;const u=((e,t,a)=>{const n=e.width+6,r=e.height+6;return{sx:Math.round((e.x-3)*t),sy:Math.round((e.y-3)*a),swidth:Math.round(n*t),sheight:Math.round(r*a),dx:0,dy:0,dwidth:Math.round(n*t),dheight:Math.round(r*a)}})(t,a,n);return await o(i,u)},getImageFromTab:c},l=a(1),d=a(4);const h=e=>new Error(`Limiter: ${e}`),g=(e,t)=>{const a=e.findIndex(e=>e>t);return a<0?[]:e.slice(a)},f={key:"ld",storage:"local"};class m{constructor(e){if(!(e&&e instanceof Object))throw h("The option object must be passed as a parameter");if(!(e.rules&&e.rules instanceof Array&&e.rules.every(e=>e instanceof Array)))throw h("Invalid format for 'rules' option.");if(e.storage&&!["local","sync","session"].includes(e.storage))throw h("Invalid value for 'storage' option.");if(this.config={...f,...e},!whale.storage||!whale.storage[this.config.storage])throw h(`Unable to use 'whale.storage.${this.config.storage}'`)}getTimes(){return new Promise(e=>{whale.storage[this.config.storage].get(this.config.key,t=>e(t[this.config.key]||[]))})}setTimes(e){return whale.storage[this.config.storage].set({[this.config.key]:e})}async check(){const e=Date.now();let t=await this.getTimes();const a=this.config.rules.reduce((e,t)=>Math.max(t[0],e),this.config.rules[0][0]);t=g(t,e-a),this.setTimes(t),this.config.rules.forEach(a=>{const[n,r]=a;if(g(t,e-n).length>=r)throw this.config.onExceed&&this.config.onExceed(a),a}),t.push(e),this.setTimes(t)}}m.minute=6e4,m.hour=6e7;var p=m;const w=new p({rules:[[p.minute,60],[p.hour,1800]],onExceed:e=>{const[t,a]=e;console.error(`Translate Image: Execution can not exceed ${a} times within ${t}ms`)}});whale.contextMenus.create({id:"OCR",title:whale.i18n.getMessage("MENUITEM_TEXT"),contexts:["image"],onclick:(e,t)=>{const{srcUrl:a,frameId:n}=e;whale.windows.update(t.windowId,{focused:!0},()=>{whale.tabs.update(t.id,{active:!0},()=>{r.a.send("ocr.start",{srcUrl:a},t.id,n)})});try{const a=e.frameUrl||e.pageUrl||t.url;ga("send","pageview",new URL(a).origin)}catch(e){console.warn(e)}}}),r.a.listen("ocr.translate",async(e,t,a)=>{const n=t.tab&&t.tab.id,{bound:r,imageUrl:s,scaleX:o,scaleY:i}=e,{srcLang:c,tarLang:h}=e,g=await u.getCropped({imageUrl:s,bound:r,scaleX:o,scaleY:i},n),{ocrs:f}=await l.a.detect({image:g,srcLang:c,tarLang:h,isUrl:!1}),m=l.a.extractTexts(f);if(m){const e=await d.a.run(c,h,m.join("\n"));a({texts:m,translated:e});try{ga("send","event","success",`${c} → ${h}`,s)}catch(e){console.warn(e)}}else{a({texts:null});try{ga("send","event","fail",`${c} → ${h}`,s)}catch(e){console.warn(e)}}}),r.a.listen("bubble",(e,t)=>{e.tabId=t.tab&&t.tab.id,r.a.send("bubble",e,e.tabId)}),r.a.listen("whomi",(e,t,a)=>{a(t)}),r.a.listen("frameRect",async(e,t,a)=>{var n,s;a(await Promise.race([await r.a.send("frameFind",e,t.tab.id,0),(n=1e3,new Promise((e,t)=>{setTimeout(()=>{t(s)},n)}))]))});r.a.listen("ocr.detect",async(e,t,a)=>{const n=t.tab&&t.tab.id;await w.check();try{a(await(async e=>{const{renderedImage:t}=await l.a.detect({...e,image:e.imageUrl,isUrl:!0}),[,a]=e.imageUrl.split(".");return`data:image/${a};base64,${t}`})(e))}catch(t){try{a(await(async e=>{const{tabId:t,imageUrl:a}=e,{blob:n,mimeType:r}=await u.getImageFromTab(t,a),{renderedImage:s}=await l.a.detect({...e,image:n,isUrl:!1});return`data:${r};base64,${s}`})({tabId:n,...e}))}catch(e){a({failed:!0})}}})},function(e,t,a){"use strict";a.r(t);const n=/。，；〈〉｛｝《》『』「」（）【】\x06\x07\x08\u3000/g,r={CJK:/[⺀-\u2efe\u3000-〾㇀-\u31ee㐀-\u4dbe一-\u9ffe豈-\ufafe]|[\ud840-\ud868\ud86a-\ud86c][\udc00-\udfff]|\ud869[\udc00-\udede\udf00-\udfff]|\ud86d[\udc00-\udf3e\udf40-\udfff]|\ud86e[\udc00-\udc1e]|\ud87e[\udc00-\ude1e]/g,ZH:/[\u3100-\u312f]/g,KO:/[ᄀ-\u11fe\u3130-ㆎ\ua960-\ua97e가-\ud7ae\ud7b0-\ud7fe]|[\uffa0-\uffdc]/g,JA:/[\u3040-ゞ゠-ヾㇰ-ㇾ]|\ud82c[\udc00-\udcfe|\uff65-\uff9d|\uff10-\uff19]/g},s=/^[\u0020-\u007F]+$/m;var o=a(0),i=a.n(o);const c=["ar","da","de","el","es","fa","fr","hi","hu","id","it","ja","ms","nl","pl","pt","ro","ru","sv","th","tr","vi","zh-CN","zh-TW"],u={nb:"no",fil:"tl","zh-HK":"zh-TW","zh-MO":"zh-TW","zh-SG":"zh-CN"},l={he:"iw",jv:"jw"},d={},h=e=>{if(e=g(e),!f(e))return"";const[t]=e.split("-");return u[e]||l[t]||e},g=(e="")=>{[e]=e.split(","),e=(e=e.replace(/\s/g,"")).replace(/_/g,"-");const[t,a]=e.split("-");return t&&a?`${t.toLowerCase()}-${a.toUpperCase()}`:e},f=e=>/[a-zA-Z]{2,3}(-[a-zA-Z]{2})?/.test(e),m=(e,t)=>new Promise(a=>{whale.i18n.detectLanguage(e,o=>{const[i]=(o.languages||[]).filter(e=>e&&e.percentage>75),c=i&&i.language||function(e,t,a){return e=e.replace(n,"").replace(/\s/g,""),s.test(e)?"en":r.KO.test(e)?"ko":r.JA.test(e)?"ja":r.ZH.test(e)?"zh":r.CJK.test(e)?a&&r.JA.test(a)||t&&("X-EUC"===(t=t.toUpperCase())||t.endsWith("JIS")||t.endsWith("JP")||t.includes("JA"))?"ja":"zh":void 0}(e,t);a(c)})});whale.webRequest.onCompleted.addListener(e=>{if(!Array.isArray(e.responseHeaders))return;const t=e.responseHeaders.find(e=>"content-language"===e.name.toLowerCase());t&&(d[e.url]=t.value)},{urls:["http://*/*","https://*/*"],types:["main_frame","sub_frame","xmlhttprequest"]}),i.a.listen("language",async(e,t,a)=>{const n=e.htmlLang||"",r=d[e.url]||"",s=await m(e.content,e.charset)||"",o=h(n)||h(r)||"";let i;if(o?o.startsWith("zh")&&s.startsWith("zh")?i=s:o.substr(0,2)===s.substr(0,2)?i=o:o.startsWith("en")&&c[s]&&(i=s):i=s,!i){const t=await m(e.meta.repeat(3),e.charset)||"";o.substr(0,2)===t.substr(0,2)&&(i=o)}i&&i.startsWith("zh")&&(i="zh-CN"),a(i)})}]);